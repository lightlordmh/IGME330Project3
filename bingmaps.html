<!DOCTYPE html>

<html lang="en">

<head>
	<meta charset="utf-8">
	<title>Bing Maps Practice</title>
	<style>
		h1 {
			margin-bottom: 5px;
			margin-top: 5px;
		}
		#Content {
			margin-bottom: 2px;
			z-index: 1;
		}
		
		#search {
			display: inline;
		}
		
		#zoomDrop {
			display: block;
			margin-bottom: 5px;
		}
		#myMap{
			z-index: 0;
		}
	</style>
	<script>
		window.onload = init;
		
		var map;
		var navigationBarMode;
		var value;
		var value2;
		var GAS_URL = "http://api.mygasfeed.com/";
		var GAS_API_KEY = "7ghfjf56rn";
		var dist;
		var gastype;
		var longitude;
		var latitude;

		
		function init(){
			value = "Rochester";
			dist = 5;
			gastype = "reg_price";
			loadMapScenario();
			document.querySelector("#search").onclick = getData;
			document.querySelector("#zoomChooser").onchange = changeZoom;
			document.querySelector("#gastypeChooser").onchange = changeGas;
			var ctr = map.getCenter();
			latitude = map.getCenter().latitude;
			longitude = map.getCenter().longitude;
			document.onclick = updateLoc;
		}
		
		function updateLoc(){
			latitude = map.getCenter().latitude;
			longitude = map.getCenter().longitude;
			printInfo();
		}
	
		function changeGas(){
			gastype = document.querySelector("#gastypeChooser").value;
			console.log(gastype);
		}
		
		function changeZoom(){
			value2 = document.querySelector("#zoomChooser").value;
			console.log(value2);
			map.setView({
				zoom: parseInt(value2)
			});
		}
	
		function getData(){
			var url = GAS_URL;
			

			value = document.querySelector("#searchterm").value;
			value = value.trim();
			if(value.length < 1) return;
			//console.log(value);
			dist = document.querySelector("#searchterm2").value;
			Microsoft.Maps.loadModule('Microsoft.Maps.Search', function () {
			var searchManager = new Microsoft.Maps.Search.SearchManager(map);
			var requestOptions = {
				bounds: map.getBounds(),
				where: value,
				callback: function (answer, userData) {
					map.setView({ bounds: answer.results[0].bestView });
					//map.entities.push(new Microsoft.Maps.Pushpin(answer.results[0].location));
				}
			};
			searchManager.geocode(requestOptions);
			if (isNaN(dist) || parseInt(dist) < 0){
				return;
			}
			dist = dist.trim();
			if(dist.length < 1) return;
			console.log(dist);
			latitude = map.getCenter().latitude;
			longitude = map.getCenter().longitude;
			});
		}
	
		function loadMapScenario() {
		navigationBarMode = Microsoft.Maps.NavigationBarMode;
			map = new Microsoft.Maps.Map(document.getElementById('myMap'), {
				credentials: 'y7SZBP21wKo65lBDPlws~HAiXZ226YEBQTxYMbCKUCw~AgYdjoumaTtW8ZZH-xz2x16G5PXiGttwQgZT6glN1rjBILJVUJ02wR6b4pL9-4fu',
				navigationBarMode: navigationBarMode.compact
			});
		}
		
		function printInfo(){
            console.log('Map center: ' + map.getCenter());
            //console.log('Map bounds: ' + map.getBounds());
            //console.log('Map type id: ' + map.getMapTypeId());
            //console.log('Map zoom level: ' + map.getZoom());
			console.log('Map latitude: ' +latitude);
			console.log('Map longitude: ' +longitude);
		}
	</script>
	<script type='text/javascript' src='https://www.bing.com/api/maps/mapcontrol?callback=loadMapScenario' async defer></script>
</head>

<body>
	<div id='printoutPanel'></div>
	 <div id="Content"><h1>Gas Station Finder</h1>
	Around what location? <input id="searchterm" type="text" size="20" maxlength="30" autofocus value="Rochester" /> 
	Within how many miles? <input id="searchterm2" type="text" size="5" maxlength="10" autofocus value="5" /> 
	<div id="gastypeDrop" class="dropdown-content">
	<label>Gas Type:
			<select id="gastypeChooser">
				<option value="reg_price">Regular</option>
				<option value="mid_price">MID</option>
				<option value="pre_price">PRE</option>
				<option value="diesel_price">Diesel</option>
    		</select>
    	</label>
	</div>
	<button type="button" id="search">Get Gas<br /></button></div>
	<div class="dropdown">
  <div id="zoomDrop" class="dropdown-content">
	<label>Zoom Level:
			<select id="zoomChooser">
				<option value="20">20</option>
				<option value="15">15</option>
				<option value="10">10</option>
				<option value="5">5</option>
    		</select>
    	</label>
	</div>
    <div id='myMap' style='width: 99vw; height: 84.8vh;'></div>
</body>

</html>